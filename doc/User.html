<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: User
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!User.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (U)</a> &raquo;
    
    
    <span class="title">User</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: User
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">User</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/models/user.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<h2 id="label-Schema+Information">Schema Information</h2>

<p>Table name: users</p>

<pre class="code ruby"><code class="ruby">id                        :integer          not null, primary key
email                     :string(255)      default(&quot;&quot;), not null
encrypted_password        :string(255)      default(&quot;&quot;), not null
reset_password_token      :string(255)
reset_password_sent_at    :datetime
remember_created_at       :datetime
sign_in_count             :integer          default(0), not null
current_sign_in_at        :datetime
last_sign_in_at           :datetime
current_sign_in_ip        :string(255)
last_sign_in_ip           :string(255)
created_at                :datetime
updated_at                :datetime
provider                  :string(255)
uid                       :string(255)
name                      :string(255)
needs_edit                :boolean          default(TRUE)
avatar_file_name          :string(255)
avatar_content_type       :string(255)
avatar_file_size          :integer
avatar_updated_at         :datetime
plan_id                   :integer
expires_in                :datetime
website                   :string(255)
bio                       :text
location                  :string(255)
username                  :string(255)
lang                      :string(255)
timezone                  :string(255)
country                   :string(255)
see_sensitive_media       :boolean          default(FALSE)
mark_sensitive_media      :boolean          default(FALSE)
facebook_json             :text
sash_id                   :integer
level                     :integer          default(0)
ranking_position          :integer
indicator_id              :integer
cpf                       :string(255)
phone                     :string(255)
birthdate                 :datetime
moip_code                 :string(255)
has_submited_payment_form :boolean          default(FALSE)
master                    :boolean          default(FALSE)
renew                     :boolean          default(TRUE)
expires_at                :datetime
moip_signature_code       :string(255)
signature_status          :string(255)
cancel_reason             :string(255)
admin                     :boolean          default(FALSE)
mailed_welcome            :boolean          default(FALSE)
sum_points                :integer          default(0)</code></pre>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="TEMP_EMAIL_PREFIX-constant" class="">TEMP_EMAIL_PREFIX =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>change@me</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="TEMP_EMAIL_REGEX-constant" class="">TEMP_EMAIL_REGEX =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Achange@me</span><span class='regexp_end'>/</span></span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_avatar-instance_method" title="#delete_avatar (instance method)">- (Object) <strong>delete_avatar</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute delete_avatar.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#terms_agree-instance_method" title="#terms_agree (instance method)">- (Object) <strong>terms_agree</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute terms_agree.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_for_oauth-class_method" title="find_for_oauth (class method)">+ (Object) <strong>find_for_oauth</strong>(auth, signed_in_resource = nil, session = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_with_session-class_method" title="new_with_session (class method)">+ (Object) <strong>new_with_session</strong>(params, session) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ranking-class_method" title="ranking (class method)">+ (Object) <strong>ranking</strong>(range_str, count = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_badge-instance_method" title="#add_badge (instance method)">- (Object) <strong>add_badge</strong>(badge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#badge_achievment_date-instance_method" title="#badge_achievment_date (instance method)">- (Object) <strong>badge_achievment_date</strong>(badge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#chapters_completeds-instance_method" title="#chapters_completeds (instance method)">- (Object) <strong>chapters_completeds</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#chapters_completeds_from_course-instance_method" title="#chapters_completeds_from_course (instance method)">- (Object) <strong>chapters_completeds_from_course</strong>(course) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#chapters_not_completeds-instance_method" title="#chapters_not_completeds (instance method)">- (Object) <strong>chapters_not_completeds</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#completed_chapter%3F-instance_method" title="#completed_chapter? (instance method)">- (Boolean) <strong>completed_chapter?</strong>(chapter) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#email_verified%3F-instance_method" title="#email_verified? (instance method)">- (Boolean) <strong>email_verified?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#finished_course%3F-instance_method" title="#finished_course? (instance method)">- (Boolean) <strong>finished_course?</strong>(course) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#finished_quiz%3F-instance_method" title="#finished_quiz? (instance method)">- (Boolean) <strong>finished_quiz?</strong>(quiz) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_sum_points-instance_method" title="#generate_sum_points (instance method)">- (Object) <strong>generate_sum_points</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_percentage_for-instance_method" title="#get_percentage_for (instance method)">- (Object) <strong>get_percentage_for</strong>(item) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_percentage_for_chapter-instance_method" title="#get_percentage_for_chapter (instance method)">- (Object) <strong>get_percentage_for_chapter</strong>(chapter) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_percentage_for_course-instance_method" title="#get_percentage_for_course (instance method)">- (Object) <strong>get_percentage_for_course</strong>(course) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_points_for-instance_method" title="#get_points_for (instance method)">- (Object) <strong>get_points_for</strong>(entity) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_badge%3F-instance_method" title="#has_badge? (instance method)">- (Boolean) <strong>has_badge?</strong>(badge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_complete_campaign-instance_method" title="#has_complete_campaign (instance method)">- (Object) <strong>has_complete_campaign</strong>(campaign) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#init_step-instance_method" title="#init_step (instance method)">- (Object) <strong>init_step</strong>(step) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialized_chapter%3F-instance_method" title="#initialized_chapter? (instance method)">- (Boolean) <strong>initialized_chapter?</strong>(chapter) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialized_course%3F-instance_method" title="#initialized_course? (instance method)">- (Boolean) <strong>initialized_course?</strong>(course) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialized_step%3F-instance_method" title="#initialized_step? (instance method)">- (Boolean) <strong>initialized_step?</strong>(step) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#moip_attributes-instance_method" title="#moip_attributes (instance method)">- (Object) <strong>moip_attributes</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#not_master%3F-instance_method" title="#not_master? (instance method)">- (Boolean) <strong>not_master?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#paid_authorized%3F-instance_method" title="#paid_authorized? (instance method)">- (Boolean) <strong>paid_authorized?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>check if an user has subscription active and pass trial that is, paid.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_uri-instance_method" title="#process_uri (instance method)">- (Object) <strong>process_uri</strong>(uri) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_badge-instance_method" title="#remove_badge (instance method)">- (Object) <strong>remove_badge</strong>(badge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#steps_completeds_from_chapter-instance_method" title="#steps_completeds_from_chapter (instance method)">- (Object) <strong>steps_completeds_from_chapter</strong>(chapter) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stepss_completeds-instance_method" title="#stepss_completeds (instance method)">- (Object) <strong>stepss_completeds</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#subscribed%3F-instance_method" title="#subscribed? (instance method)">- (Boolean) <strong>subscribed?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>check if an user has paid.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="delete_avatar=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="delete_avatar-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_avatar</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute delete_avatar</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


76
77
78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 76</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_avatar'>delete_avatar</span>
  <span class='ivar'>@delete_avatar</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="terms_agree=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="terms_agree-instance_method">
  
    - (<tt>Object</tt>) <strong>terms_agree</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute terms_agree</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 79</span>

<span class='kw'>def</span> <span class='id identifier rubyid_terms_agree'>terms_agree</span>
  <span class='ivar'>@terms_agree</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="find_for_oauth-class_method">
  
    + (<tt>Object</tt>) <strong>find_for_oauth</strong>(auth, signed_in_resource = nil, session = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 133</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_for_oauth'>find_for_oauth</span><span class='lparen'>(</span><span class='id identifier rubyid_auth'>auth</span><span class='comma'>,</span> <span class='id identifier rubyid_signed_in_resource'>signed_in_resource</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='comment'># Get the identity and user if they exist
</span>  <span class='id identifier rubyid_identity'>identity</span> <span class='op'>=</span> <span class='const'>Identity</span><span class='period'>.</span><span class='id identifier rubyid_find_for_oauth'>find_for_oauth</span><span class='lparen'>(</span><span class='id identifier rubyid_auth'>auth</span><span class='rparen'>)</span>

  <span class='comment'># If a signed_in_resource is provided it always overrides the existing user
</span>  <span class='comment'># to prevent the identity being locked with accidentally created accounts.
</span>  <span class='comment'># Note that this may leave zombie accounts (with no associated identity) which
</span>  <span class='comment'># can be cleaned up at a later date.
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_identity'>identity</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='kw'>and</span> <span class='id identifier rubyid_signed_in_resource'>signed_in_resource</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='kw'>and</span> <span class='id identifier rubyid_identity'>identity</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>!=</span> <span class='id identifier rubyid_signed_in_resource'>signed_in_resource</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span>
      <span class='label'>identity:</span> <span class='id identifier rubyid_identity'>identity</span><span class='comma'>,</span>
      <span class='label'>error_type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>has_other_user_associated</span><span class='tstring_end'>&#39;</span></span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_signed_in_resource'>signed_in_resource</span> <span class='op'>?</span> <span class='id identifier rubyid_signed_in_resource'>signed_in_resource</span> <span class='op'>:</span> <span class='id identifier rubyid_identity'>identity</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span>

  <span class='comment'># Create the user if needed
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

    <span class='comment'># Get the existing user by email if the provider gives us a verified email.
</span>    <span class='comment'># If no verified email was provided we assign a temporary email and ask the
</span>    <span class='comment'># user to verify it on the next step via UsersController.finish_signup
</span>    <span class='id identifier rubyid_email_is_verified'>email_is_verified</span> <span class='op'>=</span> <span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_verified'>verified</span> <span class='op'>||</span> <span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_verified_email'>verified_email</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_email'>email</span> <span class='op'>=</span> <span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span> <span class='kw'>if</span> <span class='id identifier rubyid_email_is_verified'>email_is_verified</span>
    <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:email</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_email'>email</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='kw'>if</span> <span class='id identifier rubyid_email'>email</span>

    <span class='comment'># Create the user if it&#39;s a new registration
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
        <span class='label'>name:</span> <span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_extra'>extra</span><span class='period'>.</span><span class='id identifier rubyid_raw_info'>raw_info</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
        <span class='comment'>#username: auth.info.nickname || auth.uid,
</span>        <span class='label'>email:</span> <span class='id identifier rubyid_email'>email</span> <span class='op'>?</span> <span class='id identifier rubyid_email'>email</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>TEMP_EMAIL_PREFIX</span><span class='embexpr_end'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='embexpr_end'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span><span class='embexpr_end'>}</span><span class='tstring_content'>.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='label'>password:</span> <span class='const'>Devise</span><span class='period'>.</span><span class='id identifier rubyid_friendly_token'>friendly_token</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>20</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='label'>indicator_id:</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:indicator_id</span><span class='rbracket'>]</span>
      <span class='rparen'>)</span>

      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_skip_confirmation!'>skip_confirmation!</span> <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:skip_confirmation</span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='const'>Plan</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span> <span class='op'>=</span> <span class='const'>Plan</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
    <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_extra'>extra</span><span class='period'>.</span><span class='id identifier rubyid_raw_info'>raw_info</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_avatar_url'>avatar_url</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_process_uri'>process_uri</span><span class='lparen'>(</span><span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_image'>image</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_update_attribute'>update_attribute</span><span class='lparen'>(</span><span class='symbol'>:avatar</span><span class='comma'>,</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_avatar_url'>avatar_url</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_facebook_json'>facebook_json</span> <span class='op'>=</span> <span class='id identifier rubyid_auth'>auth</span>
  <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>

  <span class='comment'># Associate the identity with the user if needed
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_identity'>identity</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span> <span class='op'>!=</span> <span class='id identifier rubyid_user'>user</span>
    <span class='id identifier rubyid_identity'>identity</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>
    <span class='id identifier rubyid_identity'>identity</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_user'>user</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_with_session-class_method">
  
    + (<tt>Object</tt>) <strong>new_with_session</strong>(params, session) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


206
207
208
209
210
211
212
213
214
215
216
217
218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 206</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new_with_session'>new_with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
  <span class='kw'>super</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span>

    <span class='id identifier rubyid_plan'>plan</span> <span class='op'>=</span> <span class='const'>Plan</span><span class='period'>.</span><span class='id identifier rubyid_get_current_plan'>get_current_plan</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='id identifier rubyid_plan'>plan</span>
      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span> <span class='op'>=</span> <span class='id identifier rubyid_plan'>plan</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>devise.facebook_data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>devise.facebook_data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extra</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raw_info</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>email</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ranking-class_method">
  
    + (<tt>Object</tt>) <strong>ranking</strong>(range_str, count = false) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 336</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ranking'>ranking</span> <span class='id identifier rubyid_range_str'>range_str</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>=</span><span class='kw'>false</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_range_str'>range_str</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>last_24_hours</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span><span class='op'>..</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_range_str'>range_str</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>last_7_days</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>7</span><span class='period'>.</span><span class='id identifier rubyid_days'>days</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span><span class='op'>..</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_range_str'>range_str</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>last_month</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span><span class='op'>..</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_count'>count</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:points</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span>
      <span class='label'>points:</span> <span class='lbrace'>{</span>
        <span class='label'>created_at:</span> <span class='id identifier rubyid_range'>range</span>
      <span class='rbrace'>}</span>
    <span class='rbrace'>}</span><span class='rparen'>)</span>\
    <span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*, SUM(points.value) as sum_points_value</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>\
    <span class='period'>.</span><span class='id identifier rubyid_group'>group</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>points.user_id</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>
</span><span class='id identifier rubyid_    .order'>    .order</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sum_points_value desc</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:points</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span>
      <span class='label'>points:</span> <span class='lbrace'>{</span>
        <span class='label'>created_at:</span> <span class='id identifier rubyid_range'>range</span>
      <span class='rbrace'>}</span>
    <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_badge-instance_method">
  
    - (<tt>Object</tt>) <strong>add_badge</strong>(badge) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 367</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_badge'>add_badge</span><span class='lparen'>(</span><span class='id identifier rubyid_badge'>badge</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_badge'>badge</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_has_badge?'>has_badge?</span><span class='lparen'>(</span><span class='id identifier rubyid_badge'>badge</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_badge_user'>badge_user</span> <span class='op'>=</span> <span class='const'>BadgeUser</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='label'>user:</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='label'>badge:</span> <span class='id identifier rubyid_badge'>badge</span><span class='rparen'>)</span>
    <span class='const'>Point</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='label'>user:</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='label'>pointable_id:</span> <span class='id identifier rubyid_badge'>badge</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
        <span class='label'>pointable_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Badge</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>value:</span> <span class='id identifier rubyid_badge'>badge</span><span class='period'>.</span><span class='id identifier rubyid_badge_points'>badge_points</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_badge'>badge</span><span class='period'>.</span><span class='id identifier rubyid_campaigns'>campaigns</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_campaign'>campaign</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_campaign'>campaign</span><span class='period'>.</span><span class='id identifier rubyid_has_complete_campaign?'>has_complete_campaign?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_has_complete_campaign'>has_complete_campaign</span><span class='lparen'>(</span><span class='id identifier rubyid_campaign'>campaign</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_campaigns'>campaigns</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_campaign'>campaign</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_badge_user'>badge_user</span><span class='period'>.</span><span class='id identifier rubyid_badge'>badge</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="badge_achievment_date-instance_method">
  
    - (<tt>Object</tt>) <strong>badge_achievment_date</strong>(badge) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


408
409
410</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 408</span>

<span class='kw'>def</span> <span class='id identifier rubyid_badge_achievment_date'>badge_achievment_date</span><span class='lparen'>(</span><span class='id identifier rubyid_badge'>badge</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_badge_users'>badge_users</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>badge:</span> <span class='id identifier rubyid_badge'>badge</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="chapters_completeds-instance_method">
  
    - (<tt>Object</tt>) <strong>chapters_completeds</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


279
280
281</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 279</span>

<span class='kw'>def</span> <span class='id identifier rubyid_chapters_completeds'>chapters_completeds</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_chapters'>chapters</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='period'>.</span><span class='id identifier rubyid_not'>not</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_chapters_not_completeds'>chapters_not_completeds</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='lparen'>(</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="chapters_completeds_from_course-instance_method">
  
    - (<tt>Object</tt>) <strong>chapters_completeds_from_course</strong>(course) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


291
292
293</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 291</span>

<span class='kw'>def</span> <span class='id identifier rubyid_chapters_completeds_from_course'>chapters_completeds_from_course</span><span class='lparen'>(</span><span class='id identifier rubyid_course'>course</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_chapters_completeds'>chapters_completeds</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>course_id:</span> <span class='id identifier rubyid_course'>course</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="chapters_not_completeds-instance_method">
  
    - (<tt>Object</tt>) <strong>chapters_not_completeds</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


272
273
274
275
276
277</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 272</span>

<span class='kw'>def</span> <span class='id identifier rubyid_chapters_not_completeds'>chapters_not_completeds</span>
  <span class='const'>Chapter</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_chapters'>chapters</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:steps</span><span class='rparen'>)</span><span class='period'>
</span><span class='id identifier rubyid_    .joins'>    .joins</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LEFT OUTER JOIN user_steps ON steps.id = user_steps.step_id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>
</span><span class='id identifier rubyid_    .where'>    .where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_steps.step_id is null</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>
</span><span class='id identifier rubyid_    .uniq'>    .uniq</span><span class='lparen'>(</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="completed_chapter?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>completed_chapter?</strong>(chapter) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


287
288
289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 287</span>

<span class='kw'>def</span> <span class='id identifier rubyid_completed_chapter?'>completed_chapter?</span><span class='lparen'>(</span><span class='id identifier rubyid_chapter'>chapter</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_chapters_completeds'>chapters_completeds</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_chapter'>chapter</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="email_verified?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>email_verified?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


202
203
204</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 202</span>

<span class='kw'>def</span> <span class='id identifier rubyid_email_verified?'>email_verified?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span> <span class='op'>&amp;&amp;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span> <span class='op'>!~</span> <span class='const'>TEMP_EMAIL_REGEX</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="finished_course?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>finished_course?</strong>(course) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


313
314
315</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 313</span>

<span class='kw'>def</span> <span class='id identifier rubyid_finished_course?'>finished_course?</span><span class='lparen'>(</span><span class='id identifier rubyid_course'>course</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_percentage_for_course'>get_percentage_for_course</span><span class='lparen'>(</span><span class='id identifier rubyid_course'>course</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="finished_quiz?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>finished_quiz?</strong>(quiz) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


317
318
319
320
321
322
323
324
325
326
327
328
329</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 317</span>

<span class='kw'>def</span> <span class='id identifier rubyid_finished_quiz?'>finished_quiz?</span><span class='lparen'>(</span><span class='id identifier rubyid_quiz'>quiz</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_total_questions'>total_questions</span> <span class='op'>=</span> <span class='int'>0</span><span class='comment'>#quiz.step_questions.count
</span>
  <span class='id identifier rubyid_quiz'>quiz</span><span class='period'>.</span><span class='id identifier rubyid_step_questions'>step_questions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step_question'>step_question</span><span class='op'>|</span>
    <span class='id identifier rubyid_question_answer'>question_answer</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_question_answers'>question_answers</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>step_question:</span> <span class='id identifier rubyid_step_question'>step_question</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

    <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_question_answer'>question_answer</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='kw'>and</span> <span class='id identifier rubyid_question_answer'>question_answer</span><span class='period'>.</span><span class='id identifier rubyid_step_question_option'>step_question_option</span><span class='period'>.</span><span class='id identifier rubyid_correct?'>correct?</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_total_questions'>total_questions</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_total_questions'>total_questions</span> <span class='op'>==</span> <span class='id identifier rubyid_quiz'>quiz</span><span class='period'>.</span><span class='id identifier rubyid_step_questions'>step_questions</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_sum_points-instance_method">
  
    - (<tt>Object</tt>) <strong>generate_sum_points</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


331
332
333
334</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 331</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_sum_points'>generate_sum_points</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sum_points'>sum_points</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_points'>points</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_percentage_for-instance_method">
  
    - (<tt>Object</tt>) <strong>get_percentage_for</strong>(item) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


299
300
301
302
303</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 299</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_percentage_for'>get_percentage_for</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_steps_count'>steps_count</span> <span class='op'>=</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_steps'>steps</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
  <span class='kw'>return</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_steps_count'>steps_count</span> <span class='op'>==</span> <span class='int'>0</span>
  <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_steps'>steps</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:user_steps</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='label'>user_steps:</span> <span class='lbrace'>{</span><span class='label'>user:</span> <span class='kw'>self</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>/</span> <span class='id identifier rubyid_steps_count'>steps_count</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_percentage_for_chapter-instance_method">
  
    - (<tt>Object</tt>) <strong>get_percentage_for_chapter</strong>(chapter) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


309
310
311</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 309</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_percentage_for_chapter'>get_percentage_for_chapter</span><span class='lparen'>(</span><span class='id identifier rubyid_chapter'>chapter</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_percentage_for'>get_percentage_for</span><span class='lparen'>(</span><span class='id identifier rubyid_chapter'>chapter</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_percentage_for_course-instance_method">
  
    - (<tt>Object</tt>) <strong>get_percentage_for_course</strong>(course) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


305
306
307</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 305</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_percentage_for_course'>get_percentage_for_course</span><span class='lparen'>(</span><span class='id identifier rubyid_course'>course</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_percentage_for'>get_percentage_for</span><span class='lparen'>(</span><span class='id identifier rubyid_course'>course</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_points_for-instance_method">
  
    - (<tt>Object</tt>) <strong>get_points_for</strong>(entity) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128
129
130
131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_points_for'>get_points_for</span> <span class='id identifier rubyid_entity'>entity</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_entity'>entity</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:steps</span>
    <span class='id identifier rubyid_points'>points</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_steps'>steps</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_entity'>entity</span><span class='period'>.</span><span class='id identifier rubyid_steps'>steps</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_points'>points</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_points'>points</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_points'>points</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_badge?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>has_badge?</strong>(badge) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


404
405
406</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 404</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_badge?'>has_badge?</span> <span class='id identifier rubyid_badge'>badge</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_badges'>badges</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_badge'>badge</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_complete_campaign-instance_method">
  
    - (<tt>Object</tt>) <strong>has_complete_campaign</strong>(campaign) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


400
401
402</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 400</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_complete_campaign'>has_complete_campaign</span> <span class='id identifier rubyid_campaign'>campaign</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_campaigns'>campaigns</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_campaign'>campaign</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="init_step-instance_method">
  
    - (<tt>Object</tt>) <strong>init_step</strong>(step) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


268
269
270</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 268</span>

<span class='kw'>def</span> <span class='id identifier rubyid_init_step'>init_step</span><span class='lparen'>(</span><span class='id identifier rubyid_step'>step</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_user_steps'>user_steps</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>step:</span> <span class='id identifier rubyid_step'>step</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first_or_create'>first_or_create</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialized_chapter?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>initialized_chapter?</strong>(chapter) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 260</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialized_chapter?'>initialized_chapter?</span><span class='lparen'>(</span><span class='id identifier rubyid_chapter'>chapter</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_chapters'>chapters</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_chapter'>chapter</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialized_course?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>initialized_course?</strong>(course) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 256</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialized_course?'>initialized_course?</span><span class='lparen'>(</span><span class='id identifier rubyid_course'>course</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_courses'>courses</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_course'>course</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialized_step?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>initialized_step?</strong>(step) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


264
265
266</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 264</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialized_step?'>initialized_step?</span><span class='lparen'>(</span><span class='id identifier rubyid_step'>step</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_steps'>steps</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_step'>step</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="moip_attributes-instance_method">
  
    - (<tt>Object</tt>) <strong>moip_attributes</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 228</span>

<span class='kw'>def</span> <span class='id identifier rubyid_moip_attributes'>moip_attributes</span>
  <span class='kw'>if</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='period'>.</span><span class='id identifier rubyid_production?'>production?</span>
    <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_parameterize'>parameterize</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='int'>60</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_parameterize'>parameterize</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='int'>60</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_attrs'>attrs</span> <span class='op'>=</span> <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>HashWithIndifferentAccess</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='symbol'>:email</span><span class='comma'>,</span> <span class='symbol'>:cpf</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='label'>fullname:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
    <span class='label'>birthdate_day:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_birthdate'>birthdate</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='comma'>,</span>
    <span class='label'>birthdate_month:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_birthdate'>birthdate</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span><span class='comma'>,</span>
    <span class='label'>birthdate_year:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_birthdate'>birthdate</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span>
    <span class='label'>phone_area_code:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_phone'>phone</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>) </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>phone_number:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_phone'>phone</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>) </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>code:</span> <span class='id identifier rubyid_code'>code</span><span class='comma'>,</span>
    <span class='label'>address:</span> <span class='lbrace'>{</span>
      <span class='label'>zipcode:</span> <span class='int'>58340000</span><span class='comma'>,</span>
      <span class='label'>street:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Rua Mocinha Caldas</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>number:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>203</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>district:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Nova Brasília</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>city:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sapé</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>state:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PB</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>country:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>BRA</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="not_master?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>not_master?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 119</span>

<span class='kw'>def</span> <span class='id identifier rubyid_not_master?'>not_master?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_master'>master</span> <span class='op'>==</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="paid_authorized?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>paid_authorized?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>check if an user has subscription active and pass trial that is, paid</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


419
420
421</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 419</span>

<span class='kw'>def</span> <span class='id identifier rubyid_paid_authorized?'>paid_authorized?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subscriptions'>subscriptions</span><span class='period'>.</span><span class='id identifier rubyid_real_active'>real_active</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_uri-instance_method">
  
    - (<tt>Object</tt>) <strong>process_uri</strong>(uri) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


222
223
224
225
226</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 222</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_uri'>process_uri</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='symbol'>:allow_redirections</span> <span class='op'>=&gt;</span> <span class='symbol'>:safe</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
    <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_badge-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_badge</strong>(badge) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


384
385
386
387
388
389
390
391
392
393
394
395
396
397
398</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 384</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_badge'>remove_badge</span><span class='lparen'>(</span><span class='id identifier rubyid_badge'>badge</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_badge'>badge</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_has_badge?'>has_badge?</span><span class='lparen'>(</span><span class='id identifier rubyid_badge'>badge</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_badge_user'>badge_user</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_badge_users'>badge_users</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>badge:</span> <span class='id identifier rubyid_badge'>badge</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_points_for_badge'>points_for_badge</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_points'>points</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>pointable:</span> <span class='id identifier rubyid_badge'>badge</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_points_for_badge'>points_for_badge</span><span class='period'>.</span><span class='id identifier rubyid_destroy_all'>destroy_all</span>

    <span class='id identifier rubyid_badge'>badge</span><span class='period'>.</span><span class='id identifier rubyid_campaigns'>campaigns</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_campaign'>campaign</span><span class='op'>|</span>
      <span class='id identifier rubyid_campaings_for_self_and_badge'>campaings_for_self_and_badge</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_campaign_users'>campaign_users</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>campaign:</span> <span class='id identifier rubyid_campaign'>campaign</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_campaings_for_self_and_badge'>campaings_for_self_and_badge</span><span class='period'>.</span><span class='id identifier rubyid_destroy_all'>destroy_all</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_badge_user'>badge_user</span><span class='period'>.</span><span class='id identifier rubyid_destroy_all'>destroy_all</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="steps_completeds_from_chapter-instance_method">
  
    - (<tt>Object</tt>) <strong>steps_completeds_from_chapter</strong>(chapter) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


295
296
297</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 295</span>

<span class='kw'>def</span> <span class='id identifier rubyid_steps_completeds_from_chapter'>steps_completeds_from_chapter</span><span class='lparen'>(</span><span class='id identifier rubyid_chapter'>chapter</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_stepss_completeds'>stepss_completeds</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>chapter_id:</span> <span class='id identifier rubyid_chapter'>chapter</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stepss_completeds-instance_method">
  
    - (<tt>Object</tt>) <strong>stepss_completeds</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


283
284
285</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 283</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stepss_completeds'>stepss_completeds</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_steps'>steps</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="subscribed?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>subscribed?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>check if an user has paid</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


413
414
415</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 413</span>

<span class='kw'>def</span> <span class='id identifier rubyid_subscribed?'>subscribed?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subscriptions'>subscriptions</span><span class='period'>.</span><span class='id identifier rubyid_active_or_trial'>active_or_trial</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Oct 14 15:03:41 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.5).
</div>

  </body>
</html>